@{
    Layout = null;
    <link rel="stylesheet/less" href="~/Content/less/sidenav.less">
}

@section scripts{
    <!--Script references. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
}

<div id="Overlay" class="overlay" onclick="closeNav()">

</div>

<div id="Sidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <section id="message_section">
        <a href="#" type="title">Messages</a>
        <ul id="listNotifs"></ul>
        @if (Request.IsAuthenticated)
        {
            <script type="text/javascript">
                $(function () {
                    // Declare a proxy to reference the hub.
                    var notifs = $.connection.notificationsHub;
                    //// Create a function that the hub can call to broadcast messages.
                    //notifs.client.broadcastNotification = function (author, message) {
                    //    // Html encode display name and message.
                    //    var encodedName = $('<div />').text(author).html();
                    //    var encodedMsg = $('<div />').text(message).html();
                    //    // Add the message to the page.
                    //    $('#discussion').append('<li><strong>' + encodedName
                    //        + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
                    //};
                    //// Get the user name and store it to prepend to messages.
                    //var v = document.getElementById("displayname");
                    //v.value = 'mwa';
                    //// Set initial focus to message input box.
                    //$('#message').focus();
                    // Start the connection.
                    $.connection.hub.start().done(function () {
                        //Client en lecture de notifications seulement, méthode vide
                    });
                });
            </script>
            <div>
                @foreach (AngularJS_CS.Models.Notification_Simple mes in new AngularJS_CS.Models.Dal().GetIndividus().Find(i => i.Id == int.Parse(HttpContext.Current.User.Identity.Name)).Notification_Simple)
                {

                    MvcForm form = Html.BeginForm();
                    form.ToString();
                    <text>"Affichage du form" + @(form.ToString())</text>

                    if (!mes.Message.lu && mes.Message.envoi.Hour <= System.DateTime.Now.Hour + 1)
                    {
                        if (mes.Message.sujet == "")
                        {
                            <a type="subtitle" href="#">Aucun sujet</a>
                        }
                        else
                        {
                            <a type="subtitle" href="#">@(mes.Message.sujet)</a>
                        }
                        <p>Envoyé le @(mes.Message.envoi)</p>
                        <p>@(mes.Message.contenu)</p>
                        if (mes.Message.Questionnaire.Count > 0)
                        {
                            <select id="list_rep" data-val="true" type="rep_list" name="posrep" required>

                                <option typeof="reponses" value="">Réponses</option>
                                @foreach (AngularJS_CS.Models.Reponses rep in mes.Message.Questionnaire.ElementAt(0).Reponses)
                                {
                                    <option type="reponses" value=@(rep.Id_reponse)>@(rep.Option_Questionnaire.valeur) </option>
                                }
                            </select>
                        }
                        <textarea type="repbox" id="reptext" name="reptxt"></textarea>
                        <input type="submit" value="Répondre &#128389;" onclick="closeNav()" />
                    }
                    form.EndForm();

                    using (Html.BeginForm())
                    {
                        if (!mes.Message.lu && mes.Message.envoi.Hour <= System.DateTime.Now.Hour + 1)
                        {
                            if (mes.Message.sujet == "")
                            {
                                <a type="subtitle" href="#">Aucun sujet</a>
                            }
                            else
                            {
                                <a type="subtitle" href="#">@(mes.Message.sujet)</a>
                            }
                            <p>Envoyé le @(mes.Message.envoi)</p>
                            <p>@(mes.Message.contenu)</p>
                            if (mes.Message.Questionnaire.Count > 0)
                            {
                                <select id="list_rep" data-val="true" type="rep_list" name="posrep" required>

                                    <option typeof="reponses" value="">Réponses</option>
                                    @foreach (AngularJS_CS.Models.Reponses rep in mes.Message.Questionnaire.ElementAt(0).Reponses)
                                    {
                                        <option type="reponses" value=@(rep.Id_reponse)>@(rep.Option_Questionnaire.valeur) </option>
                                    }
                                </select>
                            }
                            <textarea type="repbox" id="reptext" name="reptxt"></textarea>
                            <input type="submit" value="Répondre &#128389;" onclick="closeNav()" />
                        }
                    }

                }
            </div>
        }

    </section>
    @*<a href="#">About</a>
        <a href="#">Services</a>
        <a href="#">Clients</a>
        <a href="#">Contact</a>*@
</div>